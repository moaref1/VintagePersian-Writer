<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Old Persian Lithography Writing Interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Gulzar&family=Lateef&family=Scheherazade+New:wght@400;700&family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="candle-overlay" id="candleLayer"></div>
    
    <!-- Undo Toast -->
    <div id="undoToast" class="undo-toast">
        <span>ุชุตูุฑ ุญุฐู ุดุฏ</span>
        <button class="undo-btn" onclick="document.execCommand('undo'); hideUndoToast();">ุจุงุฒฺฏุดุช</button>
        <button style="background:none; border:none; color:#aaa; cursor:pointer;" onclick="hideUndoToast()">ร</button>
    </div>

    <!-- Project Sidebar -->
    <button class="sidebar-toggle" onclick="toggleSidebar()" title="ูพุฑูฺูโูุง">โฐ</button>
    <div class="project-sidebar" id="projectSidebar">
        <h3 style="color:#d4a04d; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">ูพุฑูฺูโูุง</h3>
        <button onclick="createNewProject()" style="background:#d4a04d; color:#000; border:none; padding:10px; border-radius:6px; cursor:pointer; width:100%; margin-bottom:20px; font-weight:bold;">+ ูพุฑูฺู ุฌุฏุฏ</button>
        <div id="projectList" style="overflow-y: auto; flex: 1;"></div>
    </div>
    
    <!-- Hover Navs -->
    <div class="nav-zone prev" onclick="prevPage()"></div>
    <div class="nav-zone next" onclick="nextPage()"></div>

    <!-- SVG Filter for Ink -->
    <svg style="display: none;">
        <defs>
            <filter id="ink-bleed">
                <feTurbulence type="fractalNoise" baseFrequency="0.03" numOctaves="3" result="noise" />
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="3.0" />
            </filter>
        </defs>
    </svg>

    <div class="vignette"></div>
    <div class="mode-indicator" id="modeIndicator">--</div>
    
    <!-- Context Format Panel -->
    <div id="contextPanel" class="context-panel">
        <span style="color: #ccc; font-size: 0.8rem; margin-left:10px;">ูุงูุจุฑ:</span>
        <button onclick="formatStyle('bold')"><b>ฑ. ุจููุฏ</b></button>
        <button onclick="applyClass('dialogue-style')">ฒ. ฺฏูุชฺฏู</button>
        <button onclick="applyClass('poetry-style')">ณ. ุดุนุฑ</button>
    </div>

    <div class="auto-save-toast" id="saveToast">ุฐุฎุฑู ุฎูุฏฺฉุงุฑ ุงูุฌุงู ุดุฏ</div>

    <!-- Raw Text Modal -->
    <div class="raw-modal" id="rawModal">
        <h2 style="color: #d4a04d; font-family: 'Vazirmatn'; margin-bottom: 1rem;">ูุฑุงุด ุณุฑุน ูุชู (Raw Text)</h2>
        <textarea class="raw-textarea" id="rawTextarea" placeholder="ูุชู ุฎูุฏ ุฑุง ุงูุฌุง ูพุณุช ฺฉูุฏ..."></textarea>
        <div class="raw-controls">
            <button onclick="saveRawText()" style="font-size: 1rem; padding: 0.5rem 2rem; background: #2ecc71; border-color: #2ecc71; color: #fff;">ุงุนูุงู ู ุจุงุฒฺฏุดุช</button>
            <button onclick="closeRawMode()" style="font-size: 1rem; padding: 0.5rem 2rem; background: #e74c3c; border-color: #e74c3c; color: #fff;">ูุบู</button>
        </div>
    </div>

    <!-- Grid Overview Modal -->
    <div id="gridOverview" class="grid-overview">
        <div class="grid-header">
            <h3>ููุง ฺฉู ุตูุญุงุช</h3>
            <button onclick="toggleGridView()" class="close-grid">ร</button>
        </div>
        <div id="gridContainer" class="grid-container"></div>
    </div>

    <!-- Top Toolbar -->
    <div class="toolbar-trigger-zone toolbar-top">
        <div class="controls">
            <button onclick="formatStyle('bold')" title="ุจููุฏ">B</button>
            <button onclick="applyClass('dialogue-style')" title="ุญุงูุช ฺฏูุชฺฏู">ฺฏูุชฺฏู</button>
            <button onclick="applyClass('poetry-style')" title="ุญุงูุช ุดุนุฑ">ุดุนุฑ</button>
            <hr class="divider">
            <button onclick="triggerImageUpload()" title="ุงูุฒูุฏู ุนฺฉุณ (Alt+P)">ุนฺฉุณ ๐ท</button>
            <input type="file" id="imgInput" accept="image/*" style="display:none;" onchange="handleImageUpload(this)">
            <hr class="divider">
            <select id="fontSelect" onchange="changeFont(this.value)">
                <option value="'Amiri', serif">ุงูุฑ</option>
                <option value="'Lateef', serif">ูุทู</option>
                <option value="'Gulzar', serif">ฺฏูุฒุงุฑ</option>
                <option value="'Vazirmatn', sans-serif">ูุฒุฑูุชู</option>
                <option value="'Scheherazade New', serif">ุดูุฑุฒุงุฏ</option>
            </select>
            <hr class="divider">
            <button onclick="saveFile()">PDF / ุฐุฎุฑู (S)</button>
        </div>
    </div>

    <!-- Bottom Panel -->
    <div class="toolbar-trigger-zone toolbar-bottom">
        <div class="controls bottom">
            <div class="shortcut-info" id="shortcutInfoBar">
                <span><span class="shortcut-key">Alt+I</span> ุฌููุฑ</span>
                <span><span class="shortcut-key">Alt+C</span> ุดูุน</span>
                <span><span class="shortcut-key">Alt+V</span> ููุง</span>
                <span><span class="shortcut-key">Alt+P</span> ุนฺฉุณ</span>
                <span><span class="shortcut-key">Alt+R</span> ุฎุงู</span>
            </div>
            
            <div style="display: flex; gap: 10px; align-items: center; justify-content: center; width: 100%;">
                <button onclick="prevPage()">โฎ ูุจู</button>
                <span id="pageInfo" style="font-size: 0.8rem; color: #bbb; min-width: 50px; text-align: center;">ฑ / ฑ</span>
                <button onclick="nextPage()">ุจุนุฏ โฏ</button>
                <hr class="divider">
                <button onclick="toggleView()" id="viewBtn">ุชฺฉ</button>
                <button onclick="toggleLowQuality()" id="lqBtn">ฺฉูุช ูพุงู</button>
                <hr class="divider">
                <button onclick="toggleInkMode()" id="inkBtn" title="ุฌููุฑ (Alt+I)">ุฌููุฑ</button>
                <button onclick="toggleCandle()" id="candleBtn" title="ุดูุน (Alt+C)">ุดูุน</button>
                <button onclick="openRawMode()" title="ูุชู ุฎุงู (Alt+R)">ุฎุงู</button>
                <button onclick="toggleGridView()" title="ููุง ฺฉู ุตูุญุงุช">ููุง ฺฉู</button>
                <hr class="divider">
                
                <!-- Color Palette (Inline Row) -->
                 <div class="color-picker-row" style="display: flex; align-items: center; gap: 8px; margin-right: 5px;">
                     <!-- Presets -->
                     <button class="color-preset" style="background:#f4e4bc;" onclick="setPaperPreset('#f4e4bc', this)" title="ูพุดโูุฑุถ"></button>
                     <button class="color-preset" style="background:#e8dcca;" onclick="setPaperPreset('#e8dcca', this)" title="ฺฉุงุบุฐ ูุฏู"></button>
                     <button class="color-preset" style="background:#dfd3c3;" onclick="setPaperPreset('#dfd3c3', this)" title="ุชุฑู"></button>
                     <button class="color-preset" style="background:#fcf5e5;" onclick="setPaperPreset('#fcf5e5', this)" title="ุฑูุดู"></button>
                     <button class="color-preset" style="background:#d8c8b0;" onclick="setPaperPreset('#d8c8b0', this)" title="ฺฉููู"></button>
                     
                     <div id="paletteContainer" style="display:flex; gap:8px; align-items:center;">
                         <!-- Custom colors will be added here via JS -->
                         
                        <div style="width: 24px; height: 24px; border-radius: 50%; overflow: hidden; border: 1px solid rgba(255,255,255,0.3);position: relative;">
                             <input type="color" id="paperColor" value="#f4e4bc" onchange="addCustomColor(this.value)" title="ุฑูฺฏ ุฏูุฎูุงู" 
                                style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; padding: 0; border: none; cursor: pointer;">
                        </div>
                     </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Book -->
    <div class="book-container" id="bookContainer">
        <div class="margin-zone left"></div>
        <div class="margin-zone right"></div>
        <div class="spine-overlay"></div>
        <article class="page" id="page-0">
            <div class="page-border"></div>
            <div class="content" contenteditable="true" spellcheck="false" placeholder="ุจููุณุฏ..."></div>
            <div class="page-number">ฐ</div>
        </article>
        <div class="page-placeholder" id="pagePlaceholder" style="display:none;"></div>
    </div>

    <script src="app.js"></script>

</body>
</html>
